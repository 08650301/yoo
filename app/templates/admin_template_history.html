<!doctype html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>版本历史: {{ template_name }}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .swal2-title { font-size: 1.25rem !important; }
        .swal2-html-container, .swal2-content { font-size: 0.9rem !important; }
        .table th, .table td { vertical-align: middle; }
    </style>
</head>
<body>
    <div class="container mt-5">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <div>
                <h1 class="h2">版本历史: <span class="text-primary">{{ template_name }}</span></h1>
                <a href="/admin/templates">« 返回模板列表</a>
            </div>
            <div>
                <button class="btn btn-danger" onclick="deleteAllVersions('{{ template_name }}')">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-trash3-fill" viewBox="0 0 16 16" style="margin-top: -3px;">
                        <path d="M11 1.5v1h3.5a.5.5 0 0 1 0 1h-.538l-.853 10.66A2 2 0 0 1 11.115 16h-6.23a2 2 0 0 1-1.994-1.84L2.038 3.5H1.5a.5.5 0 0 1 0-1H5v-1A1.5 1.5 0 0 1 6.5 0h3A1.5 1.5 0 0 1 11 1.5Zm-5 0v1h4v-1a.5.5 0 0 0-.5-.5h-3a.5.5 0 0 0-.5.5Z M4.5 5.029l.5 8.5a.5.5 0 1 0 .998-.06l-.5-8.5a.5.5 0 1 0-.998.06Zm6.53-.528a.5.5 0 0 0-.528.47l-.5 8.5a.5.5 0 0 0 .998.058l.5-8.5a.5.5 0 0 0-.47-.528ZM8 4.5a.5.5 0 0 0-.5.5v8.5a.5.5 0 0 0 1 0V5a.5.5 0 0 0-.5-.5Z"/>
                    </svg>
                    彻底删除此模板
                </button>
            </div>
        </div>

        <div class="alert alert-info">
            <strong>提示:</strong> "设为最新" 操作会将指定版本设为新的 "最新" 版本，用于克隆和管理。"发布" 操作决定了用户在前台实际使用的版本。
        </div>

        <table class="table table-hover bg-white rounded shadow-sm">
            <thead>
                <tr>
                    <th scope="col">版本</th>
                    <th scope="col">状态</th>
                    <th scope="col">创建时间</th>
                    <th scope="col" style="width: 35%;">操作</th>
                </tr>
            </thead>
            <tbody>
                {% for version in versions %}
                <tr>
                    <td class="fw-bold">
                        V{{ version.version }}
                        {% if version.is_latest %}
                            <span class="badge bg-primary ms-2">最新</span>
                        {% endif %}
                    </td>
                    <td>
                        {% if version.status == 'published' %}
                            <span class="badge bg-success">已发布</span>
                        {% else %}
                            <span class="badge bg-secondary">草稿</span>
                        {% endif %}
                    </td>
                    <td>{{ version.created_at.strftime('%Y-%m-%d %H:%M:%S') }}</td>
                    <td>
                        <a href="/admin/template/{{ version.id }}" class="btn btn-outline-secondary btn-sm">查看</a>
                        <button class="btn btn-outline-primary btn-sm ms-2" onclick="setActive({{ version.id }}, '{{ template_name }}', {{ version.version }})" {% if version.is_latest %}disabled{% endif %}>
                            设为最新
                        </button>
                        <button class="btn btn-sm ms-2 {{ 'btn-outline-warning' if version.status == 'published' else 'btn-outline-success' }}" onclick="toggleStatus({{ version.id }}, '{{ version.status }}')">
                            {{ '撤销发布' if version.status == 'published' else '发布' }}
                        </button>
                        <button class="btn btn-outline-danger btn-sm ms-2" onclick="deleteVersion({{ version.id }}, {{ version.version }})" {% if version.is_latest %}disabled{% endif %}>
                            删除
                        </button>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="/static/js/admin_api.js"></script>
    <script src="/static/js/admin_template_history.js"></script>
</body>
</html>

